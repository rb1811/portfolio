import{n as __export,r as __toESM}from"./rolldown-runtime-Bx2BaRVb.js";import{D as useNavigate,E as useLocation,O as useParams,j as require_react,k as useSearchParams}from"./chunk-UIGDSWPH-DqvTC0z0.js";import{t as env_default}from"./reflex-env-Bj0-cJax.js";import{n as jsx}from"./emotion-react.browser.esm-DaNNM3EI.js";var PACKET_TYPES=Object.create(null);PACKET_TYPES.open=`0`,PACKET_TYPES.close=`1`,PACKET_TYPES.ping=`2`,PACKET_TYPES.pong=`3`,PACKET_TYPES.message=`4`,PACKET_TYPES.upgrade=`5`,PACKET_TYPES.noop=`6`;var PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach(key$1=>{PACKET_TYPES_REVERSE[PACKET_TYPES[key$1]]=key$1});var ERROR_PACKET={type:`error`,data:`parser error`},withNativeBlob$1=typeof Blob==`function`||typeof Blob<`u`&&Object.prototype.toString.call(Blob)===`[object BlobConstructor]`,withNativeArrayBuffer$2=typeof ArrayBuffer==`function`,isView$1=obj=>typeof ArrayBuffer.isView==`function`?ArrayBuffer.isView(obj):obj&&obj.buffer instanceof ArrayBuffer,encodePacket=({type,data},supportsBinary,callback)=>withNativeBlob$1&&data instanceof Blob?supportsBinary?callback(data):encodeBlobAsBase64(data,callback):withNativeArrayBuffer$2&&(data instanceof ArrayBuffer||isView$1(data))?supportsBinary?callback(data):encodeBlobAsBase64(new Blob([data]),callback):callback(PACKET_TYPES[type]+(data||``)),encodeBlobAsBase64=(data,callback)=>{let fileReader=new FileReader;return fileReader.onload=function(){let content=fileReader.result.split(`,`)[1];callback(`b`+(content||``))},fileReader.readAsDataURL(data)};function toArray(data){return data instanceof Uint8Array?data:data instanceof ArrayBuffer?new Uint8Array(data):new Uint8Array(data.buffer,data.byteOffset,data.byteLength)}var TEXT_ENCODER;function encodePacketToBinary(packet,callback){if(withNativeBlob$1&&packet.data instanceof Blob)return packet.data.arrayBuffer().then(toArray).then(callback);if(withNativeArrayBuffer$2&&(packet.data instanceof ArrayBuffer||isView$1(packet.data)))return callback(toArray(packet.data));encodePacket(packet,!1,encoded=>{TEXT_ENCODER||=new TextEncoder,callback(TEXT_ENCODER.encode(encoded))})}var chars=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,lookup$1=typeof Uint8Array>`u`?[]:new Uint8Array(256);for(let i=0;i<64;i++)lookup$1[chars.charCodeAt(i)]=i;const decode$1=base64=>{let bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;base64[base64.length-1]===`=`&&(bufferLength--,base64[base64.length-2]===`=`&&bufferLength--);let arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4)encoded1=lookup$1[base64.charCodeAt(i)],encoded2=lookup$1[base64.charCodeAt(i+1)],encoded3=lookup$1[base64.charCodeAt(i+2)],encoded4=lookup$1[base64.charCodeAt(i+3)],bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(encoded2&15)<<4|encoded3>>2,bytes[p++]=(encoded3&3)<<6|encoded4&63;return arraybuffer};var withNativeArrayBuffer$1=typeof ArrayBuffer==`function`;const decodePacket=(encodedPacket,binaryType)=>{if(typeof encodedPacket!=`string`)return{type:`message`,data:mapBinary(encodedPacket,binaryType)};let type=encodedPacket.charAt(0);return type===`b`?{type:`message`,data:decodeBase64Packet(encodedPacket.substring(1),binaryType)}:PACKET_TYPES_REVERSE[type]?encodedPacket.length>1?{type:PACKET_TYPES_REVERSE[type],data:encodedPacket.substring(1)}:{type:PACKET_TYPES_REVERSE[type]}:ERROR_PACKET};var decodeBase64Packet=(data,binaryType)=>withNativeArrayBuffer$1?mapBinary(decode$1(data),binaryType):{base64:!0,data},mapBinary=(data,binaryType)=>{switch(binaryType){case`blob`:return data instanceof Blob?data:new Blob([data]);case`arraybuffer`:default:return data instanceof ArrayBuffer?data:data.buffer}},SEPARATOR=``,encodePayload=(packets,callback)=>{let length=packets.length,encodedPackets=Array(length),count=0;packets.forEach((packet,i)=>{encodePacket(packet,!1,encodedPacket=>{encodedPackets[i]=encodedPacket,++count===length&&callback(encodedPackets.join(SEPARATOR))})})},decodePayload=(encodedPayload,binaryType)=>{let encodedPackets=encodedPayload.split(SEPARATOR),packets=[];for(let i=0;i<encodedPackets.length;i++){let decodedPacket=decodePacket(encodedPackets[i],binaryType);if(packets.push(decodedPacket),decodedPacket.type===`error`)break}return packets};function createPacketEncoderStream(){return new TransformStream({transform(packet,controller){encodePacketToBinary(packet,encodedPacket=>{let payloadLength=encodedPacket.length,header;if(payloadLength<126)header=new Uint8Array(1),new DataView(header.buffer).setUint8(0,payloadLength);else if(payloadLength<65536){header=new Uint8Array(3);let view=new DataView(header.buffer);view.setUint8(0,126),view.setUint16(1,payloadLength)}else{header=new Uint8Array(9);let view=new DataView(header.buffer);view.setUint8(0,127),view.setBigUint64(1,BigInt(payloadLength))}packet.data&&typeof packet.data!=`string`&&(header[0]|=128),controller.enqueue(header),controller.enqueue(encodedPacket)})}})}var TEXT_DECODER;function totalLength(chunks){return chunks.reduce((acc,chunk)=>acc+chunk.length,0)}function concatChunks(chunks,size){if(chunks[0].length===size)return chunks.shift();let buffer$1=new Uint8Array(size),j=0;for(let i=0;i<size;i++)buffer$1[i]=chunks[0][j++],j===chunks[0].length&&(chunks.shift(),j=0);return chunks.length&&j<chunks[0].length&&(chunks[0]=chunks[0].slice(j)),buffer$1}function createPacketDecoderStream(maxPayload,binaryType){TEXT_DECODER||=new TextDecoder;let chunks=[],state=0,expectedLength=-1,isBinary$1=!1;return new TransformStream({transform(chunk,controller){for(chunks.push(chunk);;){if(state===0){if(totalLength(chunks)<1)break;let header=concatChunks(chunks,1);isBinary$1=(header[0]&128)==128,expectedLength=header[0]&127,state=expectedLength<126?3:expectedLength===126?1:2}else if(state===1){if(totalLength(chunks)<2)break;let headerArray=concatChunks(chunks,2);expectedLength=new DataView(headerArray.buffer,headerArray.byteOffset,headerArray.length).getUint16(0),state=3}else if(state===2){if(totalLength(chunks)<8)break;let headerArray=concatChunks(chunks,8),view=new DataView(headerArray.buffer,headerArray.byteOffset,headerArray.length),n=view.getUint32(0);if(n>2**21-1){controller.enqueue(ERROR_PACKET);break}expectedLength=n*2**32+view.getUint32(4),state=3}else{if(totalLength(chunks)<expectedLength)break;let data=concatChunks(chunks,expectedLength);controller.enqueue(decodePacket(isBinary$1?data:TEXT_DECODER.decode(data),binaryType)),state=0}if(expectedLength===0||expectedLength>maxPayload){controller.enqueue(ERROR_PACKET);break}}}})}const protocol$2=4;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key$1 in Emitter.prototype)obj[key$1]=Emitter.prototype[key$1];return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks[`$`+event]=this._callbacks[`$`+event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on$1(){this.off(event,on$1),fn.apply(this,arguments)}return on$1.fn=fn,this.on(event,on$1),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var callbacks=this._callbacks[`$`+event];if(!callbacks)return this;if(arguments.length==1)return delete this._callbacks[`$`+event],this;for(var cb,i=0;i<callbacks.length;i++)if(cb=callbacks[i],cb===fn||cb.fn===fn){callbacks.splice(i,1);break}return callbacks.length===0&&delete this._callbacks[`$`+event],this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};for(var args=Array(arguments.length-1),callbacks=this._callbacks[`$`+event],i=1;i<arguments.length;i++)args[i-1]=arguments[i];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i)callbacks[i].apply(this,args)}return this},Emitter.prototype.emitReserved=Emitter.prototype.emit,Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks[`$`+event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length};const nextTick=(()=>typeof Promise==`function`&&typeof Promise.resolve==`function`?cb=>Promise.resolve().then(cb):(cb,setTimeoutFn)=>setTimeoutFn(cb,0))(),globalThisShim=(()=>typeof self<`u`?self:typeof window<`u`?window:Function(`return this`)())(),defaultBinaryType=`arraybuffer`;function pick(obj,...attr){return attr.reduce((acc,k)=>(obj.hasOwnProperty(k)&&(acc[k]=obj[k]),acc),{})}var NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(obj,opts){opts.useNativeTimers?(obj.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),obj.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(obj.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),obj.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}var BASE64_OVERHEAD=1.33;function byteLength(obj){return typeof obj==`string`?utf8Length(obj):Math.ceil((obj.byteLength||obj.size)*BASE64_OVERHEAD)}function utf8Length(str){let c$1=0,length=0;for(let i=0,l=str.length;i<l;i++)c$1=str.charCodeAt(i),c$1<128?length+=1:c$1<2048?length+=2:c$1<55296||c$1>=57344?length+=3:(i++,length+=4);return length}function randomString(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function encode(obj){let str=``;for(let i in obj)obj.hasOwnProperty(i)&&(str.length&&(str+=`&`),str+=encodeURIComponent(i)+`=`+encodeURIComponent(obj[i]));return str}function decode(qs){let qry={},pairs=qs.split(`&`);for(let i=0,l=pairs.length;i<l;i++){let pair=pairs[i].split(`=`);qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}var TransportError=class extends Error{constructor(reason,description,context){super(reason),this.description=description,this.context=context,this.type=`TransportError`}},Transport=class extends Emitter{constructor(opts){super(),this.writable=!1,installTimerFunctions(this,opts),this.opts=opts,this.query=opts.query,this.socket=opts.socket,this.supportsBinary=!opts.forceBase64}onError(reason,description,context){return super.emitReserved(`error`,new TransportError(reason,description,context)),this}open(){return this.readyState=`opening`,this.doOpen(),this}close(){return(this.readyState===`opening`||this.readyState===`open`)&&(this.doClose(),this.onClose()),this}send(packets){this.readyState===`open`&&this.write(packets)}onOpen(){this.readyState=`open`,this.writable=!0,super.emitReserved(`open`)}onData(data){let packet=decodePacket(data,this.socket.binaryType);this.onPacket(packet)}onPacket(packet){super.emitReserved(`packet`,packet)}onClose(details){this.readyState=`closed`,super.emitReserved(`close`,details)}pause(onPause){}createUri(schema,query={}){return schema+`://`+this._hostname()+this._port()+this.opts.path+this._query(query)}_hostname(){let hostname=this.opts.hostname;return hostname.indexOf(`:`)===-1?hostname:`[`+hostname+`]`}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?`:`+this.opts.port:``}_query(query){let encodedQuery=encode(query);return encodedQuery.length?`?`+encodedQuery:``}},Polling=class extends Transport{constructor(){super(...arguments),this._polling=!1}get name(){return`polling`}doOpen(){this._poll()}pause(onPause){this.readyState=`pausing`;let pause=()=>{this.readyState=`paused`,onPause()};if(this._polling||!this.writable){let total=0;this._polling&&(total++,this.once(`pollComplete`,function(){--total||pause()})),this.writable||(total++,this.once(`drain`,function(){--total||pause()}))}else pause()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved(`poll`)}onData(data){decodePayload(data,this.socket.binaryType).forEach(packet=>{if(this.readyState===`opening`&&packet.type===`open`&&this.onOpen(),packet.type===`close`)return this.onClose({description:`transport closed by the server`}),!1;this.onPacket(packet)}),this.readyState!==`closed`&&(this._polling=!1,this.emitReserved(`pollComplete`),this.readyState===`open`&&this._poll())}doClose(){let close=()=>{this.write([{type:`close`}])};this.readyState===`open`?close():this.once(`open`,close)}write(packets){this.writable=!1,encodePayload(packets,data=>{this.doWrite(data,()=>{this.writable=!0,this.emitReserved(`drain`)})})}uri(){let schema=this.opts.secure?`https`:`http`,query=this.query||{};return!1!==this.opts.timestampRequests&&(query[this.opts.timestampParam]=randomString()),!this.supportsBinary&&!query.sid&&(query.b64=1),this.createUri(schema,query)}},value=!1;try{value=typeof XMLHttpRequest<`u`&&`withCredentials`in new XMLHttpRequest}catch{}const hasCORS=value;function empty(){}var BaseXHR=class extends Polling{constructor(opts){if(super(opts),typeof location<`u`){let isSSL=location.protocol===`https:`,port=location.port;port||=isSSL?`443`:`80`,this.xd=typeof location<`u`&&opts.hostname!==location.hostname||port!==opts.port}}doWrite(data,fn){let req=this.request({method:`POST`,data});req.on(`success`,fn),req.on(`error`,(xhrStatus,context)=>{this.onError(`xhr post error`,xhrStatus,context)})}doPoll(){let req=this.request();req.on(`data`,this.onData.bind(this)),req.on(`error`,(xhrStatus,context)=>{this.onError(`xhr poll error`,xhrStatus,context)}),this.pollXhr=req}},Request=class Request extends Emitter{constructor(createRequest,uri,opts){super(),this.createRequest=createRequest,installTimerFunctions(this,opts),this._opts=opts,this._method=opts.method||`GET`,this._uri=uri,this._data=opts.data===void 0?null:opts.data,this._create()}_create(){var _a;let opts=pick(this._opts,`agent`,`pfx`,`key`,`passphrase`,`cert`,`ca`,`ciphers`,`rejectUnauthorized`,`autoUnref`);opts.xdomain=!!this._opts.xd;let xhr=this._xhr=this.createRequest(opts);try{xhr.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders)for(let i in xhr.setDisableHeaderCheck&&xhr.setDisableHeaderCheck(!0),this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&xhr.setRequestHeader(i,this._opts.extraHeaders[i])}catch{}if(this._method===`POST`)try{xhr.setRequestHeader(`Content-type`,`text/plain;charset=UTF-8`)}catch{}try{xhr.setRequestHeader(`Accept`,`*/*`)}catch{}(_a=this._opts.cookieJar)==null||_a.addCookies(xhr),`withCredentials`in xhr&&(xhr.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(xhr.timeout=this._opts.requestTimeout),xhr.onreadystatechange=()=>{var _a$1;xhr.readyState===3&&((_a$1=this._opts.cookieJar)==null||_a$1.parseCookies(xhr.getResponseHeader(`set-cookie`))),xhr.readyState===4&&(xhr.status===200||xhr.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof xhr.status==`number`?xhr.status:0)},0))},xhr.send(this._data)}catch(e){this.setTimeoutFn(()=>{this._onError(e)},0);return}typeof document<`u`&&(this._index=Request.requestsCount++,Request.requests[this._index]=this)}_onError(err){this.emitReserved(`error`,err,this._xhr),this._cleanup(!0)}_cleanup(fromError){if(!(this._xhr===void 0||this._xhr===null)){if(this._xhr.onreadystatechange=empty,fromError)try{this._xhr.abort()}catch{}typeof document<`u`&&delete Request.requests[this._index],this._xhr=null}}_onLoad(){let data=this._xhr.responseText;data!==null&&(this.emitReserved(`data`,data),this.emitReserved(`success`),this._cleanup())}abort(){this._cleanup()}};if(Request.requestsCount=0,Request.requests={},typeof document<`u`){if(typeof attachEvent==`function`)attachEvent(`onunload`,unloadHandler);else if(typeof addEventListener==`function`){let terminationEvent=`onpagehide`in globalThisShim?`pagehide`:`unload`;addEventListener(terminationEvent,unloadHandler,!1)}}function unloadHandler(){for(let i in Request.requests)Request.requests.hasOwnProperty(i)&&Request.requests[i].abort()}var hasXHR2=(function(){let xhr=newRequest({xdomain:!1});return xhr&&xhr.responseType!==null})(),XHR=class extends BaseXHR{constructor(opts){super(opts);let forceBase64=opts&&opts.forceBase64;this.supportsBinary=hasXHR2&&!forceBase64}request(opts={}){return Object.assign(opts,{xd:this.xd},this.opts),new Request(newRequest,this.uri(),opts)}};function newRequest(opts){let xdomain=opts.xdomain;try{if(typeof XMLHttpRequest<`u`&&(!xdomain||hasCORS))return new XMLHttpRequest}catch{}if(!xdomain)try{return new globalThisShim[[`Active`,`Object`].join(`X`)](`Microsoft.XMLHTTP`)}catch{}}var isReactNative=typeof navigator<`u`&&typeof navigator.product==`string`&&navigator.product.toLowerCase()===`reactnative`,BaseWS=class extends Transport{get name(){return`websocket`}doOpen(){let uri=this.uri(),protocols=this.opts.protocols,opts=isReactNative?{}:pick(this.opts,`agent`,`perMessageDeflate`,`pfx`,`key`,`passphrase`,`cert`,`ca`,`ciphers`,`rejectUnauthorized`,`localAddress`,`protocolVersion`,`origin`,`maxPayload`,`family`,`checkServerIdentity`);this.opts.extraHeaders&&(opts.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(uri,protocols,opts)}catch(err){return this.emitReserved(`error`,err)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=closeEvent=>this.onClose({description:`websocket connection closed`,context:closeEvent}),this.ws.onmessage=ev=>this.onData(ev.data),this.ws.onerror=e=>this.onError(`websocket error`,e)}write(packets){this.writable=!1;for(let i=0;i<packets.length;i++){let packet=packets[i],lastPacket=i===packets.length-1;encodePacket(packet,this.supportsBinary,data=>{try{this.doWrite(packet,data)}catch{}lastPacket&&nextTick(()=>{this.writable=!0,this.emitReserved(`drain`)},this.setTimeoutFn)})}}doClose(){this.ws!==void 0&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let schema=this.opts.secure?`wss`:`ws`,query=this.query||{};return this.opts.timestampRequests&&(query[this.opts.timestampParam]=randomString()),this.supportsBinary||(query.b64=1),this.createUri(schema,query)}},WebSocketCtor=globalThisShim.WebSocket||globalThisShim.MozWebSocket;const transports={websocket:class extends BaseWS{createSocket(uri,protocols,opts){return isReactNative?new WebSocketCtor(uri,protocols,opts):protocols?new WebSocketCtor(uri,protocols):new WebSocketCtor(uri)}doWrite(_packet,data){this.ws.send(data)}},webtransport:class extends Transport{get name(){return`webtransport`}doOpen(){try{this._transport=new WebTransport(this.createUri(`https`),this.opts.transportOptions[this.name])}catch(err){return this.emitReserved(`error`,err)}this._transport.closed.then(()=>{this.onClose()}).catch(err=>{this.onError(`webtransport error`,err)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(stream=>{let decoderStream=createPacketDecoderStream(2**53-1,this.socket.binaryType),reader=stream.readable.pipeThrough(decoderStream).getReader(),encoderStream=createPacketEncoderStream();encoderStream.readable.pipeTo(stream.writable),this._writer=encoderStream.writable.getWriter();let read$1=()=>{reader.read().then(({done,value:value$1})=>{done||(this.onPacket(value$1),read$1())}).catch(err=>{})};read$1();let packet={type:`open`};this.query.sid&&(packet.data=`{"sid":"${this.query.sid}"}`),this._writer.write(packet).then(()=>this.onOpen())})})}write(packets){this.writable=!1;for(let i=0;i<packets.length;i++){let packet=packets[i],lastPacket=i===packets.length-1;this._writer.write(packet).then(()=>{lastPacket&&nextTick(()=>{this.writable=!0,this.emitReserved(`drain`)},this.setTimeoutFn)})}}doClose(){var _a;(_a=this._transport)==null||_a.close()}},polling:XHR};var re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=[`source`,`protocol`,`authority`,`userInfo`,`user`,`password`,`host`,`port`,`relative`,`path`,`directory`,`file`,`query`,`anchor`];function parse$1(str){if(str.length>8e3)throw`URI too long`;let src=str,b=str.indexOf(`[`),e=str.indexOf(`]`);b!=-1&&e!=-1&&(str=str.substring(0,b)+str.substring(b,e).replace(/:/g,`;`)+str.substring(e,str.length));let m=re.exec(str||``),uri={},i=14;for(;i--;)uri[parts[i]]=m[i]||``;return b!=-1&&e!=-1&&(uri.source=src,uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,`:`),uri.authority=uri.authority.replace(`[`,``).replace(`]`,``).replace(/;/g,`:`),uri.ipv6uri=!0),uri.pathNames=pathNames(uri,uri.path),uri.queryKey=queryKey(uri,uri.query),uri}function pathNames(obj,path){let names=path.replace(/\/{2,9}/g,`/`).split(`/`);return(path.slice(0,1)==`/`||path.length===0)&&names.splice(0,1),path.slice(-1)==`/`&&names.splice(names.length-1,1),names}function queryKey(uri,query){let data={};return query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function($0,$1,$2){$1&&(data[$1]=$2)}),data}var withEventListeners=typeof addEventListener==`function`&&typeof removeEventListener==`function`,OFFLINE_EVENT_LISTENERS=[];withEventListeners&&addEventListener(`offline`,()=>{OFFLINE_EVENT_LISTENERS.forEach(listener=>listener())},!1);var SocketWithoutUpgrade=class SocketWithoutUpgrade extends Emitter{constructor(uri,opts){if(super(),this.binaryType=`arraybuffer`,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,uri&&typeof uri==`object`&&(opts=uri,uri=null),uri){let parsedUri=parse$1(uri);opts.hostname=parsedUri.host,opts.secure=parsedUri.protocol===`https`||parsedUri.protocol===`wss`,opts.port=parsedUri.port,parsedUri.query&&(opts.query=parsedUri.query)}else opts.host&&(opts.hostname=parse$1(opts.host).host);installTimerFunctions(this,opts),this.secure=opts.secure==null?typeof location<`u`&&location.protocol===`https:`:opts.secure,opts.hostname&&!opts.port&&(opts.port=this.secure?`443`:`80`),this.hostname=opts.hostname||(typeof location<`u`?location.hostname:`localhost`),this.port=opts.port||(typeof location<`u`&&location.port?location.port:this.secure?`443`:`80`),this.transports=[],this._transportsByName={},opts.transports.forEach(t=>{let transportName=t.prototype.name;this.transports.push(transportName),this._transportsByName[transportName]=t}),this.opts=Object.assign({path:`/engine.io`,agent:!1,withCredentials:!1,upgrade:!0,timestampParam:`t`,rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},opts),this.opts.path=this.opts.path.replace(/\/$/,``)+(this.opts.addTrailingSlash?`/`:``),typeof this.opts.query==`string`&&(this.opts.query=decode(this.opts.query)),withEventListeners&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener(`beforeunload`,this._beforeunloadEventListener,!1)),this.hostname!==`localhost`&&(this._offlineEventListener=()=>{this._onClose(`transport close`,{description:`network connection lost`})},OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(name){let query=Object.assign({},this.opts.query);query.EIO=4,query.transport=name,this.id&&(query.sid=this.id);let opts=Object.assign({},this.opts,{query,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[name]);return new this._transportsByName[name](opts)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved(`error`,`No transports available`)},0);return}let transportName=this.opts.rememberUpgrade&&SocketWithoutUpgrade.priorWebsocketSuccess&&this.transports.indexOf(`websocket`)!==-1?`websocket`:this.transports[0];this.readyState=`opening`;let transport=this.createTransport(transportName);transport.open(),this.setTransport(transport)}setTransport(transport){this.transport&&this.transport.removeAllListeners(),this.transport=transport,transport.on(`drain`,this._onDrain.bind(this)).on(`packet`,this._onPacket.bind(this)).on(`error`,this._onError.bind(this)).on(`close`,reason=>this._onClose(`transport close`,reason))}onOpen(){this.readyState=`open`,SocketWithoutUpgrade.priorWebsocketSuccess=this.transport.name===`websocket`,this.emitReserved(`open`),this.flush()}_onPacket(packet){if(this.readyState===`opening`||this.readyState===`open`||this.readyState===`closing`)switch(this.emitReserved(`packet`,packet),this.emitReserved(`heartbeat`),packet.type){case`open`:this.onHandshake(JSON.parse(packet.data));break;case`ping`:this._sendPacket(`pong`),this.emitReserved(`ping`),this.emitReserved(`pong`),this._resetPingTimeout();break;case`error`:let err=Error(`server error`);err.code=packet.data,this._onError(err);break;case`message`:this.emitReserved(`data`,packet.data),this.emitReserved(`message`,packet.data);break}}onHandshake(data){this.emitReserved(`handshake`,data),this.id=data.sid,this.transport.query.sid=data.sid,this._pingInterval=data.pingInterval,this._pingTimeout=data.pingTimeout,this._maxPayload=data.maxPayload,this.onOpen(),this.readyState!==`closed`&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let delay=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+delay,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose(`ping timeout`)},delay),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved(`drain`):this.flush()}flush(){if(this.readyState!==`closed`&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let packets=this._getWritablePackets();this.transport.send(packets),this._prevBufferLen=packets.length,this.emitReserved(`flush`)}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name===`polling`&&this.writeBuffer.length>1))return this.writeBuffer;let payloadSize=1;for(let i=0;i<this.writeBuffer.length;i++){let data=this.writeBuffer[i].data;if(data&&(payloadSize+=byteLength(data)),i>0&&payloadSize>this._maxPayload)return this.writeBuffer.slice(0,i);payloadSize+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let hasExpired=Date.now()>this._pingTimeoutTime;return hasExpired&&(this._pingTimeoutTime=0,nextTick(()=>{this._onClose(`ping timeout`)},this.setTimeoutFn)),hasExpired}write(msg,options,fn){return this._sendPacket(`message`,msg,options,fn),this}send(msg,options,fn){return this._sendPacket(`message`,msg,options,fn),this}_sendPacket(type,data,options,fn){if(typeof data==`function`&&(fn=data,data=void 0),typeof options==`function`&&(fn=options,options=null),this.readyState===`closing`||this.readyState===`closed`)return;options||={},options.compress=!1!==options.compress;let packet={type,data,options};this.emitReserved(`packetCreate`,packet),this.writeBuffer.push(packet),fn&&this.once(`flush`,fn),this.flush()}close(){let close=()=>{this._onClose(`forced close`),this.transport.close()},cleanupAndClose=()=>{this.off(`upgrade`,cleanupAndClose),this.off(`upgradeError`,cleanupAndClose),close()},waitForUpgrade=()=>{this.once(`upgrade`,cleanupAndClose),this.once(`upgradeError`,cleanupAndClose)};return(this.readyState===`opening`||this.readyState===`open`)&&(this.readyState=`closing`,this.writeBuffer.length?this.once(`drain`,()=>{this.upgrading?waitForUpgrade():close()}):this.upgrading?waitForUpgrade():close()),this}_onError(err){if(SocketWithoutUpgrade.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState===`opening`)return this.transports.shift(),this._open();this.emitReserved(`error`,err),this._onClose(`transport error`,err)}_onClose(reason,description){if(this.readyState===`opening`||this.readyState===`open`||this.readyState===`closing`){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners(`close`),this.transport.close(),this.transport.removeAllListeners(),withEventListeners&&(this._beforeunloadEventListener&&removeEventListener(`beforeunload`,this._beforeunloadEventListener,!1),this._offlineEventListener)){let i=OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);i!==-1&&OFFLINE_EVENT_LISTENERS.splice(i,1)}this.readyState=`closed`,this.id=null,this.emitReserved(`close`,reason,description),this.writeBuffer=[],this._prevBufferLen=0}}};SocketWithoutUpgrade.protocol=4;var SocketWithUpgrade=class extends SocketWithoutUpgrade{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState===`open`&&this.opts.upgrade)for(let i=0;i<this._upgrades.length;i++)this._probe(this._upgrades[i])}_probe(name){let transport=this.createTransport(name),failed=!1;SocketWithoutUpgrade.priorWebsocketSuccess=!1;let onTransportOpen=()=>{failed||(transport.send([{type:`ping`,data:`probe`}]),transport.once(`packet`,msg=>{if(!failed)if(msg.type===`pong`&&msg.data===`probe`){if(this.upgrading=!0,this.emitReserved(`upgrading`,transport),!transport)return;SocketWithoutUpgrade.priorWebsocketSuccess=transport.name===`websocket`,this.transport.pause(()=>{failed||this.readyState!==`closed`&&(cleanup(),this.setTransport(transport),transport.send([{type:`upgrade`}]),this.emitReserved(`upgrade`,transport),transport=null,this.upgrading=!1,this.flush())})}else{let err=Error(`probe error`);err.transport=transport.name,this.emitReserved(`upgradeError`,err)}}))};function freezeTransport(){failed||(failed=!0,cleanup(),transport.close(),transport=null)}let onerror=err=>{let error=Error(`probe error: `+err);error.transport=transport.name,freezeTransport(),this.emitReserved(`upgradeError`,error)};function onTransportClose(){onerror(`transport closed`)}function onclose(){onerror(`socket closed`)}function onupgrade(to){transport&&to.name!==transport.name&&freezeTransport()}let cleanup=()=>{transport.removeListener(`open`,onTransportOpen),transport.removeListener(`error`,onerror),transport.removeListener(`close`,onTransportClose),this.off(`close`,onclose),this.off(`upgrading`,onupgrade)};transport.once(`open`,onTransportOpen),transport.once(`error`,onerror),transport.once(`close`,onTransportClose),this.once(`close`,onclose),this.once(`upgrading`,onupgrade),this._upgrades.indexOf(`webtransport`)!==-1&&name!==`webtransport`?this.setTimeoutFn(()=>{failed||transport.open()},200):transport.open()}onHandshake(data){this._upgrades=this._filterUpgrades(data.upgrades),super.onHandshake(data)}_filterUpgrades(upgrades){let filteredUpgrades=[];for(let i=0;i<upgrades.length;i++)~this.transports.indexOf(upgrades[i])&&filteredUpgrades.push(upgrades[i]);return filteredUpgrades}},Socket$1=class extends SocketWithUpgrade{constructor(uri,opts={}){let o=typeof uri==`object`?uri:opts;(!o.transports||o.transports&&typeof o.transports[0]==`string`)&&(o.transports=(o.transports||[`polling`,`websocket`,`webtransport`]).map(transportName=>transports[transportName]).filter(t=>!!t)),super(uri,o)}};const protocol$1=Socket$1.protocol;function url(uri,path=``,loc){let obj=uri;loc||=typeof location<`u`&&location,uri??=loc.protocol+`//`+loc.host,typeof uri==`string`&&(uri.charAt(0)===`/`&&(uri=uri.charAt(1)===`/`?loc.protocol+uri:loc.host+uri),/^(https?|wss?):\/\//.test(uri)||(uri=loc===void 0?`https://`+uri:loc.protocol+`//`+uri),obj=parse$1(uri)),obj.port||(/^(http|ws)$/.test(obj.protocol)?obj.port=`80`:/^(http|ws)s$/.test(obj.protocol)&&(obj.port=`443`)),obj.path=obj.path||`/`;let host=obj.host.indexOf(`:`)===-1?obj.host:`[`+obj.host+`]`;return obj.id=obj.protocol+`://`+host+`:`+obj.port+path,obj.href=obj.protocol+`://`+host+(loc&&loc.port===obj.port?``:`:`+obj.port),obj}var withNativeArrayBuffer=typeof ArrayBuffer==`function`,isView=obj=>typeof ArrayBuffer.isView==`function`?ArrayBuffer.isView(obj):obj.buffer instanceof ArrayBuffer,toString=Object.prototype.toString,withNativeBlob=typeof Blob==`function`||typeof Blob<`u`&&toString.call(Blob)===`[object BlobConstructor]`,withNativeFile=typeof File==`function`||typeof File<`u`&&toString.call(File)===`[object FileConstructor]`;function isBinary(obj){return withNativeArrayBuffer&&(obj instanceof ArrayBuffer||isView(obj))||withNativeBlob&&obj instanceof Blob||withNativeFile&&obj instanceof File}function hasBinary(obj,toJSON){if(!obj||typeof obj!=`object`)return!1;if(Array.isArray(obj)){for(let i=0,l=obj.length;i<l;i++)if(hasBinary(obj[i]))return!0;return!1}if(isBinary(obj))return!0;if(obj.toJSON&&typeof obj.toJSON==`function`&&arguments.length===1)return hasBinary(obj.toJSON(),!0);for(let key$1 in obj)if(Object.prototype.hasOwnProperty.call(obj,key$1)&&hasBinary(obj[key$1]))return!0;return!1}function deconstructPacket(packet){let buffers=[],packetData=packet.data,pack=packet;return pack.data=_deconstructPacket(packetData,buffers),pack.attachments=buffers.length,{packet:pack,buffers}}function _deconstructPacket(data,buffers){if(!data)return data;if(isBinary(data)){let placeholder={_placeholder:!0,num:buffers.length};return buffers.push(data),placeholder}else if(Array.isArray(data)){let newData=Array(data.length);for(let i=0;i<data.length;i++)newData[i]=_deconstructPacket(data[i],buffers);return newData}else if(typeof data==`object`&&!(data instanceof Date)){let newData={};for(let key$1 in data)Object.prototype.hasOwnProperty.call(data,key$1)&&(newData[key$1]=_deconstructPacket(data[key$1],buffers));return newData}return data}function reconstructPacket(packet,buffers){return packet.data=_reconstructPacket(packet.data,buffers),delete packet.attachments,packet}function _reconstructPacket(data,buffers){if(!data)return data;if(data&&data._placeholder===!0){if(typeof data.num==`number`&&data.num>=0&&data.num<buffers.length)return buffers[data.num];throw Error(`illegal attachments`)}else if(Array.isArray(data))for(let i=0;i<data.length;i++)data[i]=_reconstructPacket(data[i],buffers);else if(typeof data==`object`)for(let key$1 in data)Object.prototype.hasOwnProperty.call(data,key$1)&&(data[key$1]=_reconstructPacket(data[key$1],buffers));return data}var esm_exports=__export({Decoder:()=>Decoder,Encoder:()=>Encoder,PacketType:()=>PacketType,protocol:()=>5}),RESERVED_EVENTS$1=[`connect`,`connect_error`,`disconnect`,`disconnecting`,`newListener`,`removeListener`];const protocol=5;var PacketType;(function(PacketType$1){PacketType$1[PacketType$1.CONNECT=0]=`CONNECT`,PacketType$1[PacketType$1.DISCONNECT=1]=`DISCONNECT`,PacketType$1[PacketType$1.EVENT=2]=`EVENT`,PacketType$1[PacketType$1.ACK=3]=`ACK`,PacketType$1[PacketType$1.CONNECT_ERROR=4]=`CONNECT_ERROR`,PacketType$1[PacketType$1.BINARY_EVENT=5]=`BINARY_EVENT`,PacketType$1[PacketType$1.BINARY_ACK=6]=`BINARY_ACK`})(PacketType||={});var Encoder=class{constructor(replacer){this.replacer=replacer}encode(obj){return(obj.type===PacketType.EVENT||obj.type===PacketType.ACK)&&hasBinary(obj)?this.encodeAsBinary({type:obj.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:obj.nsp,data:obj.data,id:obj.id}):[this.encodeAsString(obj)]}encodeAsString(obj){let str=``+obj.type;return(obj.type===PacketType.BINARY_EVENT||obj.type===PacketType.BINARY_ACK)&&(str+=obj.attachments+`-`),obj.nsp&&obj.nsp!==`/`&&(str+=obj.nsp+`,`),obj.id!=null&&(str+=obj.id),obj.data!=null&&(str+=JSON.stringify(obj.data,this.replacer)),str}encodeAsBinary(obj){let deconstruction=deconstructPacket(obj),pack=this.encodeAsString(deconstruction.packet),buffers=deconstruction.buffers;return buffers.unshift(pack),buffers}};function isObject(value$1){return Object.prototype.toString.call(value$1)===`[object Object]`}var Decoder=class Decoder extends Emitter{constructor(reviver){super(),this.reviver=reviver}add(obj){let packet;if(typeof obj==`string`){if(this.reconstructor)throw Error(`got plaintext data when reconstructing a packet`);packet=this.decodeString(obj);let isBinaryEvent=packet.type===PacketType.BINARY_EVENT;isBinaryEvent||packet.type===PacketType.BINARY_ACK?(packet.type=isBinaryEvent?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(packet),packet.attachments===0&&super.emitReserved(`decoded`,packet)):super.emitReserved(`decoded`,packet)}else if(isBinary(obj)||obj.base64)if(this.reconstructor)packet=this.reconstructor.takeBinaryData(obj),packet&&(this.reconstructor=null,super.emitReserved(`decoded`,packet));else throw Error(`got binary data when not reconstructing a packet`);else throw Error(`Unknown type: `+obj)}decodeString(str){let i=0,p={type:Number(str.charAt(0))};if(PacketType[p.type]===void 0)throw Error(`unknown packet type `+p.type);if(p.type===PacketType.BINARY_EVENT||p.type===PacketType.BINARY_ACK){let start=i+1;for(;str.charAt(++i)!==`-`&&i!=str.length;);let buf=str.substring(start,i);if(buf!=Number(buf)||str.charAt(i)!==`-`)throw Error(`Illegal attachments`);p.attachments=Number(buf)}if(str.charAt(i+1)===`/`){let start=i+1;for(;++i&&!(str.charAt(i)===`,`||i===str.length););p.nsp=str.substring(start,i)}else p.nsp=`/`;let next=str.charAt(i+1);if(next!==``&&Number(next)==next){let start=i+1;for(;++i;){let c$1=str.charAt(i);if(c$1==null||Number(c$1)!=c$1){--i;break}if(i===str.length)break}p.id=Number(str.substring(start,i+1))}if(str.charAt(++i)){let payload=this.tryParse(str.substr(i));if(Decoder.isPayloadValid(p.type,payload))p.data=payload;else throw Error(`invalid payload`)}return p}tryParse(str){try{return JSON.parse(str,this.reviver)}catch{return!1}}static isPayloadValid(type,payload){switch(type){case PacketType.CONNECT:return isObject(payload);case PacketType.DISCONNECT:return payload===void 0;case PacketType.CONNECT_ERROR:return typeof payload==`string`||isObject(payload);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(payload)&&(typeof payload[0]==`number`||typeof payload[0]==`string`&&RESERVED_EVENTS$1.indexOf(payload[0])===-1);case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(payload)}}destroy(){this.reconstructor&&=(this.reconstructor.finishedReconstruction(),null)}},BinaryReconstructor=class{constructor(packet){this.packet=packet,this.buffers=[],this.reconPack=packet}takeBinaryData(binData){if(this.buffers.push(binData),this.buffers.length===this.reconPack.attachments){let packet=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),packet}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function on(obj,ev,fn){return obj.on(ev,fn),function(){obj.off(ev,fn)}}var RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Socket=class extends Emitter{constructor(io,nsp,opts){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=io,this.nsp=nsp,opts&&opts.auth&&(this.auth=opts.auth),this._opts=Object.assign({},opts),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let io=this.io;this.subs=[on(io,`open`,this.onopen.bind(this)),on(io,`packet`,this.onpacket.bind(this)),on(io,`error`,this.onerror.bind(this)),on(io,`close`,this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState===`open`&&this.onopen(),this)}open(){return this.connect()}send(...args){return args.unshift(`message`),this.emit.apply(this,args),this}emit(ev,...args){var _a,_b,_c;if(RESERVED_EVENTS.hasOwnProperty(ev))throw Error(`"`+ev.toString()+`" is a reserved event name`);if(args.unshift(ev),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(args),this;let packet={type:PacketType.EVENT,data:args};if(packet.options={},packet.options.compress=this.flags.compress!==!1,typeof args[args.length-1]==`function`){let id=this.ids++,ack=args.pop();this._registerAckCallback(id,ack),packet.id=id}let isTransportWritable=this.io.engine?.transport?.writable,isConnected=this.connected&&!this.io.engine?._hasPingExpired();return this.flags.volatile&&!isTransportWritable||(isConnected?(this.notifyOutgoingListeners(packet),this.packet(packet)):this.sendBuffer.push(packet)),this.flags={},this}_registerAckCallback(id,ack){var _a;let timeout=this.flags.timeout??this._opts.ackTimeout;if(timeout===void 0){this.acks[id]=ack;return}let timer=this.io.setTimeoutFn(()=>{delete this.acks[id];for(let i=0;i<this.sendBuffer.length;i++)this.sendBuffer[i].id===id&&this.sendBuffer.splice(i,1);ack.call(this,Error(`operation has timed out`))},timeout),fn=(...args)=>{this.io.clearTimeoutFn(timer),ack.apply(this,args)};fn.withError=!0,this.acks[id]=fn}emitWithAck(ev,...args){return new Promise((resolve,reject)=>{let fn=(arg1,arg2)=>arg1?reject(arg1):resolve(arg2);fn.withError=!0,args.push(fn),this.emit(ev,...args)})}_addToQueue(args){let ack;typeof args[args.length-1]==`function`&&(ack=args.pop());let packet={id:this._queueSeq++,tryCount:0,pending:!1,args,flags:Object.assign({fromQueue:!0},this.flags)};args.push((err,...responseArgs)=>{if(packet===this._queue[0])return err===null?(this._queue.shift(),ack&&ack(null,...responseArgs)):packet.tryCount>this._opts.retries&&(this._queue.shift(),ack&&ack(err)),packet.pending=!1,this._drainQueue()}),this._queue.push(packet),this._drainQueue()}_drainQueue(force=!1){if(!this.connected||this._queue.length===0)return;let packet=this._queue[0];packet.pending&&!force||(packet.pending=!0,packet.tryCount++,this.flags=packet.flags,this.emit.apply(this,packet.args))}packet(packet){packet.nsp=this.nsp,this.io._packet(packet)}onopen(){typeof this.auth==`function`?this.auth(data=>{this._sendConnectPacket(data)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(data){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},data):data})}onerror(err){this.connected||this.emitReserved(`connect_error`,err)}onclose(reason,description){this.connected=!1,delete this.id,this.emitReserved(`disconnect`,reason,description),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(id=>{if(!this.sendBuffer.some(packet=>String(packet.id)===id)){let ack=this.acks[id];delete this.acks[id],ack.withError&&ack.call(this,Error(`socket has been disconnected`))}})}onpacket(packet){if(packet.nsp===this.nsp)switch(packet.type){case PacketType.CONNECT:packet.data&&packet.data.sid?this.onconnect(packet.data.sid,packet.data.pid):this.emitReserved(`connect_error`,Error(`It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)`));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(packet);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(packet);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();let err=Error(packet.data.message);err.data=packet.data.data,this.emitReserved(`connect_error`,err);break}}onevent(packet){let args=packet.data||[];packet.id!=null&&args.push(this.ack(packet.id)),this.connected?this.emitEvent(args):this.receiveBuffer.push(Object.freeze(args))}emitEvent(args){if(this._anyListeners&&this._anyListeners.length){let listeners=this._anyListeners.slice();for(let listener of listeners)listener.apply(this,args)}super.emit.apply(this,args),this._pid&&args.length&&typeof args[args.length-1]==`string`&&(this._lastOffset=args[args.length-1])}ack(id){let self$1=this,sent=!1;return function(...args){sent||(sent=!0,self$1.packet({type:PacketType.ACK,id,data:args}))}}onack(packet){let ack=this.acks[packet.id];typeof ack==`function`&&(delete this.acks[packet.id],ack.withError&&packet.data.unshift(null),ack.apply(this,packet.data))}onconnect(id,pid){this.id=id,this.recovered=pid&&this._pid===pid,this._pid=pid,this.connected=!0,this.emitBuffered(),this.emitReserved(`connect`),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(args=>this.emitEvent(args)),this.receiveBuffer=[],this.sendBuffer.forEach(packet=>{this.notifyOutgoingListeners(packet),this.packet(packet)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose(`io server disconnect`)}destroy(){this.subs&&=(this.subs.forEach(subDestroy=>subDestroy()),void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose(`io client disconnect`),this}close(){return this.disconnect()}compress(compress){return this.flags.compress=compress,this}get volatile(){return this.flags.volatile=!0,this}timeout(timeout){return this.flags.timeout=timeout,this}onAny(listener){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(listener),this}prependAny(listener){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(listener),this}offAny(listener){if(!this._anyListeners)return this;if(listener){let listeners=this._anyListeners;for(let i=0;i<listeners.length;i++)if(listener===listeners[i])return listeners.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(listener){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(listener),this}prependAnyOutgoing(listener){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(listener),this}offAnyOutgoing(listener){if(!this._anyOutgoingListeners)return this;if(listener){let listeners=this._anyOutgoingListeners;for(let i=0;i<listeners.length;i++)if(listener===listeners[i])return listeners.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(packet){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let listeners=this._anyOutgoingListeners.slice();for(let listener of listeners)listener.apply(this,packet.data)}}};function Backoff(opts){opts||={},this.ms=opts.min||100,this.max=opts.max||1e4,this.factor=opts.factor||2,this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*this.factor**+ this.attempts++;if(this.jitter){var rand=Math.random(),deviation=Math.floor(rand*this.jitter*ms);ms=Math.floor(rand*10)&1?ms+deviation:ms-deviation}return Math.min(ms,this.max)|0},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(min){this.ms=min},Backoff.prototype.setMax=function(max){this.max=max},Backoff.prototype.setJitter=function(jitter){this.jitter=jitter};var Manager=class extends Emitter{constructor(uri,opts){var _a;super(),this.nsps={},this.subs=[],uri&&typeof uri==`object`&&(opts=uri,uri=void 0),opts||={},opts.path=opts.path||`/socket.io`,this.opts=opts,installTimerFunctions(this,opts),this.reconnection(opts.reconnection!==!1),this.reconnectionAttempts(opts.reconnectionAttempts||1/0),this.reconnectionDelay(opts.reconnectionDelay||1e3),this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3),this.randomizationFactor(opts.randomizationFactor??.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(opts.timeout==null?2e4:opts.timeout),this._readyState=`closed`,this.uri=uri;let _parser=opts.parser||esm_exports;this.encoder=new _parser.Encoder,this.decoder=new _parser.Decoder,this._autoConnect=opts.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(v){return arguments.length?(this._reconnection=!!v,v||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(v){return v===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=v,this)}reconnectionDelay(v){var _a;return v===void 0?this._reconnectionDelay:(this._reconnectionDelay=v,(_a=this.backoff)==null||_a.setMin(v),this)}randomizationFactor(v){var _a;return v===void 0?this._randomizationFactor:(this._randomizationFactor=v,(_a=this.backoff)==null||_a.setJitter(v),this)}reconnectionDelayMax(v){var _a;return v===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=v,(_a=this.backoff)==null||_a.setMax(v),this)}timeout(v){return arguments.length?(this._timeout=v,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(fn){if(~this._readyState.indexOf(`open`))return this;this.engine=new Socket$1(this.uri,this.opts);let socket=this.engine,self$1=this;this._readyState=`opening`,this.skipReconnect=!1;let openSubDestroy=on(socket,`open`,function(){self$1.onopen(),fn&&fn()}),onError=err=>{this.cleanup(),this._readyState=`closed`,this.emitReserved(`error`,err),fn?fn(err):this.maybeReconnectOnOpen()},errorSub=on(socket,`error`,onError);if(!1!==this._timeout){let timeout=this._timeout,timer=this.setTimeoutFn(()=>{openSubDestroy(),onError(Error(`timeout`)),socket.close()},timeout);this.opts.autoUnref&&timer.unref(),this.subs.push(()=>{this.clearTimeoutFn(timer)})}return this.subs.push(openSubDestroy),this.subs.push(errorSub),this}connect(fn){return this.open(fn)}onopen(){this.cleanup(),this._readyState=`open`,this.emitReserved(`open`);let socket=this.engine;this.subs.push(on(socket,`ping`,this.onping.bind(this)),on(socket,`data`,this.ondata.bind(this)),on(socket,`error`,this.onerror.bind(this)),on(socket,`close`,this.onclose.bind(this)),on(this.decoder,`decoded`,this.ondecoded.bind(this)))}onping(){this.emitReserved(`ping`)}ondata(data){try{this.decoder.add(data)}catch(e){this.onclose(`parse error`,e)}}ondecoded(packet){nextTick(()=>{this.emitReserved(`packet`,packet)},this.setTimeoutFn)}onerror(err){this.emitReserved(`error`,err)}socket(nsp,opts){let socket=this.nsps[nsp];return socket?this._autoConnect&&!socket.active&&socket.connect():(socket=new Socket(this,nsp,opts),this.nsps[nsp]=socket),socket}_destroy(socket){let nsps=Object.keys(this.nsps);for(let nsp of nsps)if(this.nsps[nsp].active)return;this._close()}_packet(packet){let encodedPackets=this.encoder.encode(packet);for(let i=0;i<encodedPackets.length;i++)this.engine.write(encodedPackets[i],packet.options)}cleanup(){this.subs.forEach(subDestroy=>subDestroy()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose(`forced close`)}disconnect(){return this._close()}onclose(reason,description){var _a;this.cleanup(),(_a=this.engine)==null||_a.close(),this.backoff.reset(),this._readyState=`closed`,this.emitReserved(`close`,reason,description),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let self$1=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved(`reconnect_failed`),this._reconnecting=!1;else{let delay=this.backoff.duration();this._reconnecting=!0;let timer=this.setTimeoutFn(()=>{self$1.skipReconnect||(this.emitReserved(`reconnect_attempt`,self$1.backoff.attempts),!self$1.skipReconnect&&self$1.open(err=>{err?(self$1._reconnecting=!1,self$1.reconnect(),this.emitReserved(`reconnect_error`,err)):self$1.onreconnect()}))},delay);this.opts.autoUnref&&timer.unref(),this.subs.push(()=>{this.clearTimeoutFn(timer)})}}onreconnect(){let attempt=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved(`reconnect`,attempt)}},cache={};function lookup(uri,opts){typeof uri==`object`&&(opts=uri,uri=void 0),opts||={};let parsed=url(uri,opts.path||`/socket.io`),source$1=parsed.source,id=parsed.id,path=parsed.path,sameNamespace=cache[id]&&path in cache[id].nsps,newConnection=opts.forceNew||opts[`force new connection`]||!1===opts.multiplex||sameNamespace,io;return newConnection?io=new Manager(source$1,opts):(cache[id]||(cache[id]=new Manager(source$1,opts)),io=cache[id]),parsed.query&&!opts.query&&(opts.query=parsed.queryKey),io.socket(parsed.path,opts)}Object.assign(lookup,{Manager,Socket,io:lookup,connect:lookup});var unicode={Space_Separator:/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,ID_Start:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,ID_Continue:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},util={isSpaceSeparator(c$1){return typeof c$1==`string`&&unicode.Space_Separator.test(c$1)},isIdStartChar(c$1){return typeof c$1==`string`&&(c$1>=`a`&&c$1<=`z`||c$1>=`A`&&c$1<=`Z`||c$1===`$`||c$1===`_`||unicode.ID_Start.test(c$1))},isIdContinueChar(c$1){return typeof c$1==`string`&&(c$1>=`a`&&c$1<=`z`||c$1>=`A`&&c$1<=`Z`||c$1>=`0`&&c$1<=`9`||c$1===`$`||c$1===`_`||c$1===``||c$1===``||unicode.ID_Continue.test(c$1))},isDigit(c$1){return typeof c$1==`string`&&/[0-9]/.test(c$1)},isHexDigit(c$1){return typeof c$1==`string`&&/[0-9A-Fa-f]/.test(c$1)}},source,parseState,stack,pos,line,column,token$1,key,root,parse=function(text,reviver){source=String(text),parseState=`start`,stack=[],pos=0,line=1,column=0,token$1=void 0,key=void 0,root=void 0;do token$1=lex(),parseStates[parseState]();while(token$1.type!==`eof`);return typeof reviver==`function`?internalize({"":root},``,reviver):root};function internalize(holder,name,reviver){let value$1=holder[name];if(typeof value$1==`object`&&value$1)if(Array.isArray(value$1))for(let i=0;i<value$1.length;i++){let key$1=String(i),replacement=internalize(value$1,key$1,reviver);replacement===void 0?delete value$1[key$1]:Object.defineProperty(value$1,key$1,{value:replacement,writable:!0,enumerable:!0,configurable:!0})}else for(let key$1 in value$1){let replacement=internalize(value$1,key$1,reviver);replacement===void 0?delete value$1[key$1]:Object.defineProperty(value$1,key$1,{value:replacement,writable:!0,enumerable:!0,configurable:!0})}return reviver.call(holder,name,value$1)}var lexState,buffer,doubleQuote,sign,c;function lex(){for(lexState=`default`,buffer=``,doubleQuote=!1,sign=1;;){c=peek();let token$2=lexStates[lexState]();if(token$2)return token$2}}function peek(){if(source[pos])return String.fromCodePoint(source.codePointAt(pos))}function read(){let c$1=peek();return c$1===`
`?(line++,column=0):c$1?column+=c$1.length:column++,c$1&&(pos+=c$1.length),c$1}var lexStates={default(){switch(c){case`	`:case`\v`:case`\f`:case` `:case`\xA0`:case``:case`
`:case`\r`:case`\u2028`:case`\u2029`:read();return;case`/`:read(),lexState=`comment`;return;case void 0:return read(),newToken(`eof`)}if(util.isSpaceSeparator(c)){read();return}return lexStates[parseState]()},comment(){switch(c){case`*`:read(),lexState=`multiLineComment`;return;case`/`:read(),lexState=`singleLineComment`;return}throw invalidChar(read())},multiLineComment(){switch(c){case`*`:read(),lexState=`multiLineCommentAsterisk`;return;case void 0:throw invalidChar(read())}read()},multiLineCommentAsterisk(){switch(c){case`*`:read();return;case`/`:read(),lexState=`default`;return;case void 0:throw invalidChar(read())}read(),lexState=`multiLineComment`},singleLineComment(){switch(c){case`
`:case`\r`:case`\u2028`:case`\u2029`:read(),lexState=`default`;return;case void 0:return read(),newToken(`eof`)}read()},value(){switch(c){case`{`:case`[`:return newToken(`punctuator`,read());case`n`:return read(),literal(`ull`),newToken(`null`,null);case`t`:return read(),literal(`rue`),newToken(`boolean`,!0);case`f`:return read(),literal(`alse`),newToken(`boolean`,!1);case`-`:case`+`:read()===`-`&&(sign=-1),lexState=`sign`;return;case`.`:buffer=read(),lexState=`decimalPointLeading`;return;case`0`:buffer=read(),lexState=`zero`;return;case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:buffer=read(),lexState=`decimalInteger`;return;case`I`:return read(),literal(`nfinity`),newToken(`numeric`,1/0);case`N`:return read(),literal(`aN`),newToken(`numeric`,NaN);case`"`:case`'`:doubleQuote=read()===`"`,buffer=``,lexState=`string`;return}throw invalidChar(read())},identifierNameStartEscape(){if(c!==`u`)throw invalidChar(read());read();let u=unicodeEscape();switch(u){case`$`:case`_`:break;default:if(!util.isIdStartChar(u))throw invalidIdentifier();break}buffer+=u,lexState=`identifierName`},identifierName(){switch(c){case`$`:case`_`:case``:case``:buffer+=read();return;case`\\`:read(),lexState=`identifierNameEscape`;return}if(util.isIdContinueChar(c)){buffer+=read();return}return newToken(`identifier`,buffer)},identifierNameEscape(){if(c!==`u`)throw invalidChar(read());read();let u=unicodeEscape();switch(u){case`$`:case`_`:case``:case``:break;default:if(!util.isIdContinueChar(u))throw invalidIdentifier();break}buffer+=u,lexState=`identifierName`},sign(){switch(c){case`.`:buffer=read(),lexState=`decimalPointLeading`;return;case`0`:buffer=read(),lexState=`zero`;return;case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:buffer=read(),lexState=`decimalInteger`;return;case`I`:return read(),literal(`nfinity`),newToken(`numeric`,sign*(1/0));case`N`:return read(),literal(`aN`),newToken(`numeric`,NaN)}throw invalidChar(read())},zero(){switch(c){case`.`:buffer+=read(),lexState=`decimalPoint`;return;case`e`:case`E`:buffer+=read(),lexState=`decimalExponent`;return;case`x`:case`X`:buffer+=read(),lexState=`hexadecimal`;return}return newToken(`numeric`,sign*0)},decimalInteger(){switch(c){case`.`:buffer+=read(),lexState=`decimalPoint`;return;case`e`:case`E`:buffer+=read(),lexState=`decimalExponent`;return}if(util.isDigit(c)){buffer+=read();return}return newToken(`numeric`,sign*Number(buffer))},decimalPointLeading(){if(util.isDigit(c)){buffer+=read(),lexState=`decimalFraction`;return}throw invalidChar(read())},decimalPoint(){switch(c){case`e`:case`E`:buffer+=read(),lexState=`decimalExponent`;return}if(util.isDigit(c)){buffer+=read(),lexState=`decimalFraction`;return}return newToken(`numeric`,sign*Number(buffer))},decimalFraction(){switch(c){case`e`:case`E`:buffer+=read(),lexState=`decimalExponent`;return}if(util.isDigit(c)){buffer+=read();return}return newToken(`numeric`,sign*Number(buffer))},decimalExponent(){switch(c){case`+`:case`-`:buffer+=read(),lexState=`decimalExponentSign`;return}if(util.isDigit(c)){buffer+=read(),lexState=`decimalExponentInteger`;return}throw invalidChar(read())},decimalExponentSign(){if(util.isDigit(c)){buffer+=read(),lexState=`decimalExponentInteger`;return}throw invalidChar(read())},decimalExponentInteger(){if(util.isDigit(c)){buffer+=read();return}return newToken(`numeric`,sign*Number(buffer))},hexadecimal(){if(util.isHexDigit(c)){buffer+=read(),lexState=`hexadecimalInteger`;return}throw invalidChar(read())},hexadecimalInteger(){if(util.isHexDigit(c)){buffer+=read();return}return newToken(`numeric`,sign*Number(buffer))},string(){switch(c){case`\\`:read(),buffer+=escape();return;case`"`:if(doubleQuote)return read(),newToken(`string`,buffer);buffer+=read();return;case`'`:if(!doubleQuote)return read(),newToken(`string`,buffer);buffer+=read();return;case`
`:case`\r`:throw invalidChar(read());case`\u2028`:case`\u2029`:separatorChar(c);break;case void 0:throw invalidChar(read())}buffer+=read()},start(){switch(c){case`{`:case`[`:return newToken(`punctuator`,read())}lexState=`value`},beforePropertyName(){switch(c){case`$`:case`_`:buffer=read(),lexState=`identifierName`;return;case`\\`:read(),lexState=`identifierNameStartEscape`;return;case`}`:return newToken(`punctuator`,read());case`"`:case`'`:doubleQuote=read()===`"`,lexState=`string`;return}if(util.isIdStartChar(c)){buffer+=read(),lexState=`identifierName`;return}throw invalidChar(read())},afterPropertyName(){if(c===`:`)return newToken(`punctuator`,read());throw invalidChar(read())},beforePropertyValue(){lexState=`value`},afterPropertyValue(){switch(c){case`,`:case`}`:return newToken(`punctuator`,read())}throw invalidChar(read())},beforeArrayValue(){if(c===`]`)return newToken(`punctuator`,read());lexState=`value`},afterArrayValue(){switch(c){case`,`:case`]`:return newToken(`punctuator`,read())}throw invalidChar(read())},end(){throw invalidChar(read())}};function newToken(type,value$1){return{type,value:value$1,line,column}}function literal(s){for(let c$1 of s){if(peek()!==c$1)throw invalidChar(read());read()}}function escape(){switch(peek()){case`b`:return read(),`\b`;case`f`:return read(),`\f`;case`n`:return read(),`
`;case`r`:return read(),`\r`;case`t`:return read(),`	`;case`v`:return read(),`\v`;case`0`:if(read(),util.isDigit(peek()))throw invalidChar(read());return`\0`;case`x`:return read(),hexEscape();case`u`:return read(),unicodeEscape();case`
`:case`\u2028`:case`\u2029`:return read(),``;case`\r`:return read(),peek()===`
`&&read(),``;case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:throw invalidChar(read());case void 0:throw invalidChar(read())}return read()}function hexEscape(){let buffer$1=``,c$1=peek();if(!util.isHexDigit(c$1)||(buffer$1+=read(),c$1=peek(),!util.isHexDigit(c$1)))throw invalidChar(read());return buffer$1+=read(),String.fromCodePoint(parseInt(buffer$1,16))}function unicodeEscape(){let buffer$1=``,count=4;for(;count-- >0;){let c$1=peek();if(!util.isHexDigit(c$1))throw invalidChar(read());buffer$1+=read()}return String.fromCodePoint(parseInt(buffer$1,16))}var parseStates={start(){if(token$1.type===`eof`)throw invalidEOF();push()},beforePropertyName(){switch(token$1.type){case`identifier`:case`string`:key=token$1.value,parseState=`afterPropertyName`;return;case`punctuator`:pop();return;case`eof`:throw invalidEOF()}},afterPropertyName(){if(token$1.type===`eof`)throw invalidEOF();parseState=`beforePropertyValue`},beforePropertyValue(){if(token$1.type===`eof`)throw invalidEOF();push()},beforeArrayValue(){if(token$1.type===`eof`)throw invalidEOF();if(token$1.type===`punctuator`&&token$1.value===`]`){pop();return}push()},afterPropertyValue(){if(token$1.type===`eof`)throw invalidEOF();switch(token$1.value){case`,`:parseState=`beforePropertyName`;return;case`}`:pop()}},afterArrayValue(){if(token$1.type===`eof`)throw invalidEOF();switch(token$1.value){case`,`:parseState=`beforeArrayValue`;return;case`]`:pop()}},end(){}};function push(){let value$1;switch(token$1.type){case`punctuator`:switch(token$1.value){case`{`:value$1={};break;case`[`:value$1=[];break}break;case`null`:case`boolean`:case`numeric`:case`string`:value$1=token$1.value;break}if(root===void 0)root=value$1;else{let parent=stack[stack.length-1];Array.isArray(parent)?parent.push(value$1):Object.defineProperty(parent,key,{value:value$1,writable:!0,enumerable:!0,configurable:!0})}if(typeof value$1==`object`&&value$1)stack.push(value$1),parseState=Array.isArray(value$1)?`beforeArrayValue`:`beforePropertyName`;else{let current=stack[stack.length-1];parseState=current==null?`end`:Array.isArray(current)?`afterArrayValue`:`afterPropertyValue`}}function pop(){stack.pop();let current=stack[stack.length-1];parseState=current==null?`end`:Array.isArray(current)?`afterArrayValue`:`afterPropertyValue`}function invalidChar(c$1){return syntaxError(c$1===void 0?`JSON5: invalid end of input at ${line}:${column}`:`JSON5: invalid character '${formatChar(c$1)}' at ${line}:${column}`)}function invalidEOF(){return syntaxError(`JSON5: invalid end of input at ${line}:${column}`)}function invalidIdentifier(){return column-=5,syntaxError(`JSON5: invalid identifier character at ${line}:${column}`)}function separatorChar(c$1){console.warn(`JSON5: '${formatChar(c$1)}' in strings is not valid ECMAScript; consider escaping`)}function formatChar(c$1){let replacements={"'":`\\'`,'"':`\\"`,"\\":`\\\\`,"\b":`\\b`,"\f":`\\f`,"\n":`\\n`,"\r":`\\r`,"	":`\\t`,"\v":`\\v`,"\0":`\\0`,"\u2028":`\\u2028`,"\u2029":`\\u2029`};if(replacements[c$1])return replacements[c$1];if(c$1<` `){let hexString=c$1.charCodeAt(0).toString(16);return`\\x`+(`00`+hexString).substring(hexString.length)}return c$1}function syntaxError(message){let err=SyntaxError(message);return err.lineNumber=line,err.columnNumber=column,err}var dist_default={parse,stringify:function(value$1,replacer,space){let stack$1=[],indent=``,propertyList,replacerFunc,gap=``,quote;if(typeof replacer==`object`&&replacer&&!Array.isArray(replacer)&&(space=replacer.space,quote=replacer.quote,replacer=replacer.replacer),typeof replacer==`function`)replacerFunc=replacer;else if(Array.isArray(replacer)){propertyList=[];for(let v of replacer){let item;typeof v==`string`?item=v:(typeof v==`number`||v instanceof String||v instanceof Number)&&(item=String(v)),item!==void 0&&propertyList.indexOf(item)<0&&propertyList.push(item)}}return space instanceof Number?space=Number(space):space instanceof String&&(space=String(space)),typeof space==`number`?space>0&&(space=Math.min(10,Math.floor(space)),gap=`          `.substr(0,space)):typeof space==`string`&&(gap=space.substr(0,10)),serializeProperty(``,{"":value$1});function serializeProperty(key$1,holder){let value$2=holder[key$1];switch(value$2!=null&&(typeof value$2.toJSON5==`function`?value$2=value$2.toJSON5(key$1):typeof value$2.toJSON==`function`&&(value$2=value$2.toJSON(key$1))),replacerFunc&&(value$2=replacerFunc.call(holder,key$1,value$2)),value$2 instanceof Number?value$2=Number(value$2):value$2 instanceof String?value$2=String(value$2):value$2 instanceof Boolean&&(value$2=value$2.valueOf()),value$2){case null:return`null`;case!0:return`true`;case!1:return`false`}if(typeof value$2==`string`)return quoteString(value$2,!1);if(typeof value$2==`number`)return String(value$2);if(typeof value$2==`object`)return Array.isArray(value$2)?serializeArray(value$2):serializeObject(value$2)}function quoteString(value$2){let quotes={"'":.1,'"':.2},replacements={"'":`\\'`,'"':`\\"`,"\\":`\\\\`,"\b":`\\b`,"\f":`\\f`,"\n":`\\n`,"\r":`\\r`,"	":`\\t`,"\v":`\\v`,"\0":`\\0`,"\u2028":`\\u2028`,"\u2029":`\\u2029`},product=``;for(let i=0;i<value$2.length;i++){let c$1=value$2[i];switch(c$1){case`'`:case`"`:quotes[c$1]++,product+=c$1;continue;case`\0`:if(util.isDigit(value$2[i+1])){product+=`\\x00`;continue}}if(replacements[c$1]){product+=replacements[c$1];continue}if(c$1<` `){let hexString=c$1.charCodeAt(0).toString(16);product+=`\\x`+(`00`+hexString).substring(hexString.length);continue}product+=c$1}let quoteChar=quote||Object.keys(quotes).reduce((a,b)=>quotes[a]<quotes[b]?a:b);return product=product.replace(new RegExp(quoteChar,`g`),replacements[quoteChar]),quoteChar+product+quoteChar}function serializeObject(value$2){if(stack$1.indexOf(value$2)>=0)throw TypeError(`Converting circular structure to JSON5`);stack$1.push(value$2);let stepback=indent;indent+=gap;let keys=propertyList||Object.keys(value$2),partial=[];for(let key$1 of keys){let propertyString=serializeProperty(key$1,value$2);if(propertyString!==void 0){let member=serializeKey(key$1)+`:`;gap!==``&&(member+=` `),member+=propertyString,partial.push(member)}}let final;if(partial.length===0)final=`{}`;else{let properties;if(gap===``)properties=partial.join(`,`),final=`{`+properties+`}`;else{let separator=`,
`+indent;properties=partial.join(separator),final=`{
`+indent+properties+`,
`+stepback+`}`}}return stack$1.pop(),indent=stepback,final}function serializeKey(key$1){if(key$1.length===0)return quoteString(key$1,!0);let firstChar=String.fromCodePoint(key$1.codePointAt(0));if(!util.isIdStartChar(firstChar))return quoteString(key$1,!0);for(let i=firstChar.length;i<key$1.length;i++)if(!util.isIdContinueChar(String.fromCodePoint(key$1.codePointAt(i))))return quoteString(key$1,!0);return key$1}function serializeArray(value$2){if(stack$1.indexOf(value$2)>=0)throw TypeError(`Converting circular structure to JSON5`);stack$1.push(value$2);let stepback=indent;indent+=gap;let partial=[];for(let i=0;i<value$2.length;i++){let propertyString=serializeProperty(String(i),value$2);partial.push(propertyString===void 0?`null`:propertyString)}let final;if(partial.length===0)final=`[]`;else if(gap===``)final=`[`+partial.join(`,`)+`]`;else{let separator=`,
`+indent,properties=partial.join(separator);final=`[
`+indent+properties+`,
`+stepback+`]`}return stack$1.pop(),indent=stepback,final}}};const version=`0.8.19`,project_hash=15383738769117082e22,last_reflex_run_datetime=`2025-12-09 16:10:20.707326`;var reflex_default={version:`0.8.19`,project_hash:15383738769117082e22,last_reflex_run_datetime:`2025-12-09 16:10:20.707326`},cookie={},hasRequiredCookie;function requireCookie(){if(hasRequiredCookie)return cookie;hasRequiredCookie=1,cookie.parse=parse$2,cookie.serialize=serialize;var __toString=Object.prototype.toString,__hasOwnProperty=Object.prototype.hasOwnProperty,cookieNameRegExp=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,cookieValueRegExp=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,domainValueRegExp=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,pathValueRegExp=/^[\u0020-\u003A\u003D-\u007E]*$/;function parse$2(str,opt){if(typeof str!=`string`)throw TypeError(`argument str must be a string`);var obj={},len=str.length;if(len<2)return obj;var dec=opt&&opt.decode||decode$2,index=0,eqIdx=0,endIdx=0;do{if(eqIdx=str.indexOf(`=`,index),eqIdx===-1)break;if(endIdx=str.indexOf(`;`,index),endIdx===-1)endIdx=len;else if(eqIdx>endIdx){index=str.lastIndexOf(`;`,eqIdx-1)+1;continue}var keyStartIdx=startIndex(str,index,eqIdx),keyEndIdx=endIndex(str,eqIdx,keyStartIdx),key$1=str.slice(keyStartIdx,keyEndIdx);if(!__hasOwnProperty.call(obj,key$1)){var valStartIdx=startIndex(str,eqIdx+1,endIdx),valEndIdx=endIndex(str,endIdx,valStartIdx);str.charCodeAt(valStartIdx)===34&&str.charCodeAt(valEndIdx-1)===34&&(valStartIdx++,valEndIdx--),obj[key$1]=tryDecode(str.slice(valStartIdx,valEndIdx),dec)}index=endIdx+1}while(index<len);return obj}function startIndex(str,index,max){do{var code=str.charCodeAt(index);if(code!==32&&code!==9)return index}while(++index<max);return max}function endIndex(str,index,min){for(;index>min;){var code=str.charCodeAt(--index);if(code!==32&&code!==9)return index+1}return min}function serialize(name,val,opt){var enc=opt&&opt.encode||encodeURIComponent;if(typeof enc!=`function`)throw TypeError(`option encode is invalid`);if(!cookieNameRegExp.test(name))throw TypeError(`argument name is invalid`);var value$1=enc(val);if(!cookieValueRegExp.test(value$1))throw TypeError(`argument val is invalid`);var str=name+`=`+value$1;if(!opt)return str;if(opt.maxAge!=null){var maxAge=Math.floor(opt.maxAge);if(!isFinite(maxAge))throw TypeError(`option maxAge is invalid`);str+=`; Max-Age=`+maxAge}if(opt.domain){if(!domainValueRegExp.test(opt.domain))throw TypeError(`option domain is invalid`);str+=`; Domain=`+opt.domain}if(opt.path){if(!pathValueRegExp.test(opt.path))throw TypeError(`option path is invalid`);str+=`; Path=`+opt.path}if(opt.expires){var expires=opt.expires;if(!isDate(expires)||isNaN(expires.valueOf()))throw TypeError(`option expires is invalid`);str+=`; Expires=`+expires.toUTCString()}if(opt.httpOnly&&(str+=`; HttpOnly`),opt.secure&&(str+=`; Secure`),opt.partitioned&&(str+=`; Partitioned`),opt.priority)switch(typeof opt.priority==`string`?opt.priority.toLowerCase():opt.priority){case`low`:str+=`; Priority=Low`;break;case`medium`:str+=`; Priority=Medium`;break;case`high`:str+=`; Priority=High`;break;default:throw TypeError(`option priority is invalid`)}if(opt.sameSite)switch(typeof opt.sameSite==`string`?opt.sameSite.toLowerCase():opt.sameSite){case!0:str+=`; SameSite=Strict`;break;case`lax`:str+=`; SameSite=Lax`;break;case`strict`:str+=`; SameSite=Strict`;break;case`none`:str+=`; SameSite=None`;break;default:throw TypeError(`option sameSite is invalid`)}return str}function decode$2(str){return str.indexOf(`%`)===-1?str:decodeURIComponent(str)}function isDate(val){return __toString.call(val)===`[object Date]`}function tryDecode(str,decode$3){try{return decode$3(str)}catch{return str}}return cookie}var cookieExports=requireCookie();function hasDocumentCookie(){let testingValue=typeof global>`u`?void 0:global.TEST_HAS_DOCUMENT_COOKIE;return typeof testingValue==`boolean`?testingValue:typeof document==`object`&&typeof document.cookie==`string`}function parseCookies(cookies$1){return typeof cookies$1==`string`?cookieExports.parse(cookies$1):typeof cookies$1==`object`&&cookies$1?cookies$1:{}}function readCookie(value$1,options={}){let cleanValue=cleanupCookieValue(value$1);if(!options.doNotParse)try{return JSON.parse(cleanValue)}catch{}return value$1}function cleanupCookieValue(value$1){return value$1&&value$1[0]===`j`&&value$1[1]===`:`?value$1.substr(2):value$1}var Cookies=class{constructor(cookies$1,defaultSetOptions={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;let previousCookies=this.cookies;this.cookies=cookieExports.parse(document.cookie),this._checkChanges(previousCookies)};let domCookies=typeof document>`u`?``:document.cookie;this.cookies=parseCookies(cookies$1||domCookies),this.defaultSetOptions=defaultSetOptions,this.HAS_DOCUMENT_COOKIE=hasDocumentCookie()}_emitChange(params){for(let i=0;i<this.changeListeners.length;++i)this.changeListeners[i](params)}_checkChanges(previousCookies){new Set(Object.keys(previousCookies).concat(Object.keys(this.cookies))).forEach(name=>{previousCookies[name]!==this.cookies[name]&&this._emitChange({name,value:readCookie(this.cookies[name])})})}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(name,options={}){return options.doNotUpdate||this.update(),readCookie(this.cookies[name],options)}getAll(options={}){options.doNotUpdate||this.update();let result={};for(let name in this.cookies)result[name]=readCookie(this.cookies[name],options);return result}set(name,value$1,options){options=options?Object.assign(Object.assign({},this.defaultSetOptions),options):this.defaultSetOptions;let stringValue=typeof value$1==`string`?value$1:JSON.stringify(value$1);this.cookies=Object.assign(Object.assign({},this.cookies),{[name]:stringValue}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=cookieExports.serialize(name,stringValue,options)),this._emitChange({name,value:value$1,options})}remove(name,options){let finalOptions=options=Object.assign(Object.assign(Object.assign({},this.defaultSetOptions),options),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[name],this.HAS_DOCUMENT_COOKIE&&(document.cookie=cookieExports.serialize(name,``,finalOptions)),this._emitChange({name,value:void 0,options})}addChangeListener(callback){this.changeListeners.push(callback),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===1&&(typeof window==`object`&&`cookieStore`in window?window.cookieStore.addEventListener(`change`,this.update):this._startPolling())}removeChangeListener(callback){let idx=this.changeListeners.indexOf(callback);idx>=0&&this.changeListeners.splice(idx,1),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===0&&(typeof window==`object`&&`cookieStore`in window?window.cookieStore.removeEventListener(`change`,this.update):this._stopPolling())}},debounce_timeout_id={};function debounce(name,func,delay){let key$1=`${name}__${delay}`;clearTimeout(debounce_timeout_id[key$1]),debounce_timeout_id[key$1]=setTimeout(()=>{func(),delete debounce_timeout_id[key$1]},delay)}var in_throttle={};function throttle(name,limit){let key$1=`${name}__${limit}`;return in_throttle[key$1]?!1:(in_throttle[key$1]=!0,setTimeout(()=>{delete in_throttle[key$1]},limit),!0)}const uploadFiles=async(handler,files,upload_id,on_upload_progress,extra_headers,socket,refs$1,getBackendURL$1,getToken$1)=>{if(files===void 0||files.length===0)return!1;let upload_ref_name=`__upload_controllers_${upload_id}`;if(refs$1[upload_ref_name])return console.log(`Upload already in progress for `,upload_id),!1;let resp_idx=0,eventHandler=progressEvent=>{let event_callbacks=socket._callbacks.$event;progressEvent.event.target.responseText.trim().split(`
`).slice(resp_idx).map(chunk_json=>{try{let chunk=dist_default.parse(chunk_json);event_callbacks.map((f,ix)=>{f(chunk).then(()=>{ix===event_callbacks.length-1&&(resp_idx+=1)}).catch(e=>{progressEvent.progress===1&&console.log(`Error processing chunk`,chunk,e)})})}catch(e){progressEvent.progress===1&&console.log(`Error parsing chunk`,chunk_json,e);return}})},controller=new AbortController,formdata=new FormData;return files.forEach(file=>{formdata.append(`files`,file,file.path||file.name)}),refs$1[upload_ref_name]=controller,new Promise((resolve,reject)=>{let xhr=new XMLHttpRequest;xhr.onload=function(){xhr.status>=200&&xhr.status<300?resolve({data:xhr.responseText,status:xhr.status,statusText:xhr.statusText,headers:{get:name=>xhr.getResponseHeader(name)}}):reject(Error(`HTTP error! status: ${xhr.status}`))},xhr.onerror=function(){reject(Error(`Network error`))},xhr.onabort=function(){reject(Error(`Upload aborted`))},on_upload_progress&&(xhr.upload.onprogress=function(event){event.lengthComputable&&on_upload_progress({loaded:event.loaded,total:event.total,progress:event.loaded/event.total})}),xhr.onprogress=function(event){eventHandler&&eventHandler({event:{target:{responseText:xhr.responseText}},progress:event.lengthComputable?event.loaded/event.total:0})},controller.signal.addEventListener(`abort`,()=>{xhr.abort()}),xhr.open(`POST`,getBackendURL$1(env_default.UPLOAD)),xhr.setRequestHeader(`Reflex-Client-Token`,getToken$1()),xhr.setRequestHeader(`Reflex-Event-Handler`,handler);for(let[key$1,value$1]of Object.entries(extra_headers||{}))xhr.setRequestHeader(key$1,value$1);try{xhr.send(formdata)}catch(error){reject(error)}}).catch(error=>(console.log(`Upload error:`,error.message),!1)).finally(()=>{delete refs$1[upload_ref_name]})};var state_exports=__export({ReflexEvent:()=>ReflexEvent,applyDelta:()=>applyDelta,applyEvent:()=>applyEvent,applyRestEvent:()=>applyRestEvent,connect:()=>connect,evalReactComponent:()=>evalReactComponent,generateUUID:()=>generateUUID,getBackendURL:()=>getBackendURL,getRefValue:()=>getRefValue,getRefValues:()=>getRefValues,getToken:()=>getToken,hydrateClientStorage:()=>hydrateClientStorage,isBackendDisabled:()=>isBackendDisabled,isNotNullOrUndefined:()=>isNotNullOrUndefined,isStateful:()=>isStateful,isTrue:()=>isTrue,processEvent:()=>processEvent,queueEventIfSocketExists:()=>queueEventIfSocketExists,queueEvents:()=>queueEvents,refs:()=>refs,spreadArraysOrObjects:()=>spreadArraysOrObjects,useEventLoop:()=>useEventLoop}),import_react=__toESM(require_react()),EVENTURL=env_default.EVENT,SAME_DOMAIN_HOSTNAMES=[`localhost`,`0.0.0.0`,`::`,`0:0:0:0:0:0:0:0`],token,TOKEN_KEY=`token`,cookies=new Cookies;const refs={};var event_processing=!1,event_queue=[];const generateUUID=()=>{let d=new Date().getTime(),d2=performance&&performance.now&&performance.now()*1e3||0;return`xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`.replace(/[xy]/g,c$1=>{let r=Math.random()*16;return d>0?(r=(d+r)%16|0,d=Math.floor(d/16)):(r=(d2+r)%16|0,d2=Math.floor(d2/16)),(c$1==`x`?r:r&7|8).toString(16)})},getToken=()=>token||(typeof window<`u`&&(window.sessionStorage.getItem(TOKEN_KEY)||window.sessionStorage.setItem(TOKEN_KEY,generateUUID()),token=window.sessionStorage.getItem(TOKEN_KEY)),token),getBackendURL=url_str=>{let endpoint=new URL(url_str);return typeof window<`u`&&SAME_DOMAIN_HOSTNAMES.includes(endpoint.hostname)&&(endpoint.hostname=window.location.hostname,window.location.protocol===`https:`&&(endpoint.protocol===`ws:`?endpoint.protocol=`wss:`:endpoint.protocol===`http:`&&(endpoint.protocol=`https:`),endpoint.port=``)),endpoint},isBackendDisabled=()=>{let cookie$1=document.cookie.split(`; `).find(row=>row.startsWith(`backend-enabled=`));return cookie$1!==void 0&&cookie$1.split(`=`)[1]==`false`},isStateful=()=>event_queue.length===0?!1:event_queue.some(event=>event.name.startsWith(`reflex___state`)),applyDelta=(state,delta)=>({...state,...delta}),evalReactComponent=async component=>{!window.React&&window.__reflex&&(window.React=window.__reflex.react);let dataUri=`data:text/javascript;charset=utf-8,`+encodeURIComponent(component);return(await eval(`import(dataUri)`)).default},queueEventIfSocketExists=async(events,socket,navigate,params)=>{socket&&await queueEvents(events,socket,!1,navigate,params)};function urlFrom(string){try{return new URL(string)}catch{return}}const applyEvent=async(event,socket,navigate,params)=>{if(event.name==`_redirect`){if((event.payload.path??void 0)===void 0)return!1;if(event.payload.external)return window.open(event.payload.path,`_blank`,`noopener`+(event.payload.popup?`,popup`:``)),!1;let url$1=urlFrom(event.payload.path),pathname=event.payload.path;if(url$1){if(url$1.host!==window.location.host)return window.location.assign(event.payload.path),!1;pathname=url$1.pathname+url$1.search+url$1.hash}return event.payload.replace?navigate(pathname,{replace:!0}):navigate(pathname),!1}if(event.name==`_remove_cookie`)return cookies.remove(event.payload.key,{...event.payload.options}),queueEventIfSocketExists(initialEvents(),socket,navigate,params),!1;if(event.name==`_clear_local_storage`)return localStorage.clear(),queueEventIfSocketExists(initialEvents(),socket,navigate,params),!1;if(event.name==`_remove_local_storage`)return localStorage.removeItem(event.payload.key),queueEventIfSocketExists(initialEvents(),socket,navigate,params),!1;if(event.name==`_clear_session_storage`)return sessionStorage.clear(),queueEventIfSocketExists(initialEvents(),socket,navigate,params),!1;if(event.name==`_remove_session_storage`)return sessionStorage.removeItem(event.payload.key),queueEventIfSocketExists(initialEvents(),socket,navigate,params),!1;if(event.name==`_download`){let a=document.createElement(`a`);return a.hidden=!0,a.href=event.payload.url,a.href.includes(`getBackendURL(env.UPLOAD)`)&&(a.href=eval?.(event.payload.url.replace(`getBackendURL(env.UPLOAD)`,`"${getBackendURL(env_default.UPLOAD)}"`))),a.download=event.payload.filename,a.click(),a.remove(),!1}if(event.name==`_set_focus`){let current=(event.payload.ref in refs?refs[event.payload.ref]:event.payload.ref)?.current;return current===void 0||current?.focus===void 0?console.error(`No element found for ref ${event.payload.ref} in _set_focus`):current.focus(),!1}if(event.name==`_blur_focus`){let current=(event.payload.ref in refs?refs[event.payload.ref]:event.payload.ref)?.current;return current===void 0||current?.blur===void 0?console.error(`No element found for ref ${event.payload.ref} in _blur_focus`):current.blur(),!1}if(event.name==`_set_value`){let ref=event.payload.ref in refs?refs[event.payload.ref]:event.payload.ref;return ref.current&&(ref.current.value=event.payload.value),!1}if(event.name==`_call_function`&&typeof event.payload.function!=`string`){try{let eval_result=event.payload.function();if(event.payload.callback){let final_result=eval_result&&typeof eval_result.then==`function`?await eval_result:eval_result;(typeof event.payload.callback==`string`?eval(event.payload.callback):event.payload.callback)(final_result)}}catch(e){console.log(`_call_function`,e),window&&window?.onerror&&window.onerror(e.message,null,null,null,e)}return!1}if(event.name==`_call_script`||event.name==`_call_function`){try{let eval_result=event.name==`_call_script`?eval(event.payload.javascript_code):eval(event.payload.function)();if(event.payload.callback){let final_result=eval_result&&typeof eval_result.then==`function`?await eval_result:eval_result;(typeof event.payload.callback==`string`?eval(event.payload.callback):event.payload.callback)(final_result)}}catch(e){console.log(`_call_script`,e),window&&window?.onerror&&window.onerror(e.message,null,null,null,e)}return!1}return event.token=getToken(),(event.router_data===void 0||Object.keys(event.router_data).length===0)&&(event.router_data={pathname:window.location.pathname,query:{...Object.fromEntries(new URLSearchParams(window.location.search)),...params()},asPath:window.location.pathname+window.location.search+window.location.hash}),socket?(socket.emit(`event`,event),!0):!1},applyRestEvent=async(event,socket,navigate,params)=>{let eventSent=!1;return event.handler===`uploadFiles`?event.payload.files===void 0||event.payload.files.length===0?await applyEvent(ReflexEvent(event.name,{files:[]}),socket,navigate,params):(uploadFiles(event.name,event.payload.files,event.payload.upload_id,event.payload.on_upload_progress,event.payload.extra_headers,socket,refs,getBackendURL,getToken),!1):!1},queueEvents=async(events,socket,prepend,navigate,params)=>{prepend&&(events=[...events,...Array.from({length:event_queue.length}).map(()=>event_queue.shift())]),event_queue.push(...events.filter(e=>e!=null)),await processEvent(socket.current,navigate,params)},processEvent=async(socket,navigate,params)=>{if(isStateful()&&!(socket&&socket.connected)||event_queue.length===0||event_processing)return;event_processing=!0;let event=event_queue.shift(),eventSent=!1;eventSent=event.handler?await applyRestEvent(event,socket,navigate,params):await applyEvent(event,socket,navigate,params),eventSent||(event_processing=!1,await processEvent(socket,navigate,params))},connect=async(socket,dispatch,transports$1,setConnectErrors,client_storage={},navigate,params)=>{if(socket.current){socket.current.connected||socket.current.reconnect();return}let endpoint=getBackendURL(EVENTURL),on_hydrated_queue=[];socket.current=lookup(endpoint.href,{path:endpoint.pathname,transports:transports$1,protocols:[reflex_default.version],autoUnref:!1,query:{token:getToken()},reconnection:!1}),socket.current.wait_connect=!socket.current.connected,socket.current.io.encoder.replacer=(k,v)=>v===void 0?null:v,socket.current.io.decoder.tryParse=str=>{try{return dist_default.parse(str)}catch{return!1}},socket.current.reconnect=()=>{socket.current&&!socket.current.connected&&!socket.current.wait_connect&&(socket.current.wait_connect=!0,socket.current.io.opts.query={token:getToken()},socket.current.connect())};function checkVisibility(){document.visibilityState===`visible`&&(socket.current?socket.current.connected?console.log(`Socket is reconnected `):(console.log(`Socket is disconnected, attempting to reconnect `),socket.current.reconnect()):connect(socket,dispatch,transports$1,setConnectErrors,client_storage,navigate,params))}let disconnectTrigger=event=>{socket.current?.connected&&(console.log(`Disconnect websocket on unload`),socket.current.disconnect())},pagehideHandler=event=>{event.persisted&&socket.current?.connected&&(console.log(`Disconnect backend before bfcache on navigation`),socket.current.disconnect())};socket.current.on(`connect`,async()=>{for(socket.current.wait_connect=!1,setConnectErrors([]),window.addEventListener(`pagehide`,pagehideHandler),window.addEventListener(`beforeunload`,disconnectTrigger),window.addEventListener(`unload`,disconnectTrigger);event_queue.length>0&&!event_processing;)await processEvent(socket.current,navigate,()=>params.current)}),socket.current.on(`connect_error`,error=>{socket.current.wait_connect=!1;let n_connect_errors=0;setConnectErrors(connectErrors=>{let new_errors=[...connectErrors.slice(-9),error];return n_connect_errors=new_errors.length,new_errors}),window.setTimeout(()=>{socket.current&&!socket.current.connected&&socket.current.reconnect()},200*n_connect_errors)}),socket.current.on(`disconnect`,(reason,details)=>{socket.current.wait_connect=!1;let try_reconnect=reason!==`io server disconnect`&&reason!==`io client disconnect`;event_processing=!1,window.removeEventListener(`unload`,disconnectTrigger),window.removeEventListener(`beforeunload`,disconnectTrigger),window.removeEventListener(`pagehide`,pagehideHandler),try_reconnect&&socket.current.reconnect()}),socket.current.on(`event`,async update=>{for(let substate in update.delta)dispatch[substate](update.delta[substate]),substate===void 0&&update.delta[substate]?.is_hydrated_rx_state_&&(queueEvents(on_hydrated_queue,socket,!1,navigate,params),on_hydrated_queue.length=0);applyClientStorageDelta(client_storage,update.delta),update.final!==null&&(event_processing=!update.final),update.events&&queueEvents(update.events,socket,!1,navigate,params)}),socket.current.on(`reload`,async event=>{event_processing=!1,on_hydrated_queue.push(event),queueEvents(initialEvents(),socket,!0,navigate,params)}),socket.current.on(`new_token`,async new_token=>{token=new_token,window.sessionStorage.setItem(TOKEN_KEY,new_token)}),document.addEventListener(`visibilitychange`,checkVisibility)},ReflexEvent=(name,payload={},event_actions={},handler=null)=>({name,payload,handler,event_actions}),hydrateClientStorage=client_storage=>{let client_storage_values={};if(client_storage.cookies)for(let state_key in client_storage.cookies){let cookie_name=client_storage.cookies[state_key].name||state_key,cookie_value=cookies.get(cookie_name,{doNotParse:!0});cookie_value!==void 0&&(client_storage_values[state_key]=cookie_value)}if(client_storage.local_storage&&typeof window<`u`)for(let state_key in client_storage.local_storage){let options=client_storage.local_storage[state_key],local_storage_value=localStorage.getItem(options.name||state_key);local_storage_value!==null&&(client_storage_values[state_key]=local_storage_value)}if(client_storage.session_storage&&typeof window<`u`)for(let state_key in client_storage.session_storage){let session_options=client_storage.session_storage[state_key],session_storage_value=sessionStorage.getItem(session_options.name||state_key);session_storage_value!=null&&(client_storage_values[state_key]=session_storage_value)}return client_storage.cookies||client_storage.local_storage||client_storage.session_storage?client_storage_values:{}};var applyClientStorageDelta=(client_storage,delta)=>{let unqualified_states=Object.keys(delta).filter(key$1=>key$1.split(`.`).length===1);if(unqualified_states.length===1){let main_state=delta[unqualified_states[0]];if(main_state.is_hydrated_rx_state_!==void 0&&!main_state.is_hydrated_rx_state_)return}for(let substate in delta)for(let key$1 in delta[substate]){let state_key=`${substate}.${key$1}`;if(client_storage.cookies&&state_key in client_storage.cookies){let cookie_options={...client_storage.cookies[state_key]},cookie_name=cookie_options.name||state_key;delete cookie_options.name,cookies.set(cookie_name,delta[substate][key$1],cookie_options)}else if(client_storage.local_storage&&state_key in client_storage.local_storage&&typeof window<`u`){let options=client_storage.local_storage[state_key];localStorage.setItem(options.name||state_key,delta[substate][key$1])}else if(client_storage.session_storage&&state_key in client_storage.session_storage&&typeof window<`u`){let session_options=client_storage.session_storage[state_key];sessionStorage.setItem(session_options.name||state_key,delta[substate][key$1])}}};const useEventLoop=(dispatch,initial_events=()=>[],client_storage={})=>{let socket=(0,import_react.useRef)(null),location$1=useLocation(),navigate=useNavigate(),paramsR=useParams(),prevLocationRef=(0,import_react.useRef)(location$1),[searchParams]=useSearchParams(),[connectErrors,setConnectErrors]=(0,import_react.useState)([]),params=(0,import_react.useRef)(paramsR),mounted=(0,import_react.useRef)(!1);(0,import_react.useEffect)(()=>{let{"*":splat,...remainingParams}=paramsR;splat?params.current={...remainingParams,splat:splat.split(`/`)}:params.current=remainingParams},[paramsR]);let ensureSocketConnected=(0,import_react.useCallback)(async()=>{mounted.current&&Object.keys(initialState).length>1&&!isBackendDisabled()&&!socket.current?.connected&&await connect(socket,dispatch,[env_default.TRANSPORT],setConnectErrors,client_storage,navigate,()=>params.current)},[socket,dispatch,setConnectErrors,client_storage,navigate,params,mounted]),addEvents=(0,import_react.useCallback)((events,args,event_actions)=>{let _events=events.filter(e=>e!=null);event_actions?.temporal||ensureSocketConnected(),args instanceof Array||(args=[args]),event_actions=_events.reduce((acc,e)=>({...acc,...e.event_actions}),event_actions??{});let _e=args.filter(o=>o?.preventDefault!==void 0)[0];event_actions?.preventDefault&&_e?.preventDefault&&_e.preventDefault(),event_actions?.stopPropagation&&_e?.stopPropagation&&_e.stopPropagation();let combined_name=_events.map(e=>e.name).join(`+++`);event_actions?.temporal&&(!socket.current||!socket.current.connected)||event_actions?.throttle&&!throttle(combined_name,event_actions.throttle)||(event_actions?.debounce?debounce(combined_name,()=>queueEvents(_events,socket,!1,navigate,()=>params.current),event_actions.debounce):queueEvents(_events,socket,!1,navigate,()=>params.current))},[]),sentHydrate=(0,import_react.useRef)(!1);(0,import_react.useEffect)(()=>{sentHydrate.current||=(queueEvents(initial_events(),socket,!0,navigate,()=>params.current),!0)},[]),(0,import_react.useEffect)(()=>{typeof window>`u`||(window.onerror=function(msg,url$1,lineNo,columnNo,error){return addEvents([ReflexEvent(`undefined.handle_frontend_exception`,{info:error.name+`: `+error.message+`
`+error.stack,component_stack:``})]),!1},window.onunhandledrejection=function(event){return addEvents([ReflexEvent(`undefined.handle_frontend_exception`,{info:event.reason?.name+`: `+event.reason?.message+`
`+event.reason?.stack,component_stack:``})]),!1})},[]),(0,import_react.useEffect)(()=>(mounted.current=!0,ensureSocketConnected(),()=>{mounted.current=!1,socket.current&&=(socket.current.disconnect(),socket.current.off(),null)}),[]),(0,import_react.useEffect)(()=>{isBackendDisabled()||!socket.current||!socket.current.connected||(async()=>{for(;event_queue.length>0&&!event_processing;)await ensureSocketConnected(),await processEvent(socket.current,navigate,()=>params.current)})()}),(0,import_react.useEffect)(()=>{let storage_to_state_map={};if(client_storage.local_storage&&typeof window<`u`)for(let state_key in client_storage.local_storage){let options=client_storage.local_storage[state_key];if(options.sync){let local_storage_value_key=options.name||state_key;storage_to_state_map[local_storage_value_key]=state_key}}let handleStorage=e=>{if(storage_to_state_map[e.key]){let vars={};vars[storage_to_state_map[e.key]]=e.newValue,addEvents([ReflexEvent(`undefined.reflex___state____update_vars_internal_state.update_vars_internal`,{vars})],e)}};return window.addEventListener(`storage`,handleStorage),()=>window.removeEventListener(`storage`,handleStorage)});let handleNavigationEvents=(0,import_react.useRef)(!1);return(0,import_react.useEffect)(()=>{if(!handleNavigationEvents.current){handleNavigationEvents.current=!0;return}if(location$1.state?.fromNotFound||location$1.pathname+location$1.search===prevLocationRef.current.pathname+prevLocationRef.current.search&&location$1.hash)return;let main_state_dispatch=dispatch.reflex___state____state;main_state_dispatch!==void 0&&main_state_dispatch({is_hydrated_rx_state_:!1}),addEvents(onLoadInternalEvent()),prevLocationRef.current=location$1},[location$1,dispatch,onLoadInternalEvent,addEvents]),[addEvents,connectErrors]},isTrue=val=>Array.isArray(val)?val.length>0:val===Object(val)?Object.keys(val).length>0:!!val,isNotNullOrUndefined=val=>(val??void 0)!==void 0,getRefValue=ref=>{if(!(!ref||!ref.current))return ref.current.type==`checkbox`?ref.current.checked:ref.current.className?.includes(`rt-CheckboxRoot`)||ref.current.className?.includes(`rt-SwitchRoot`)?ref.current.ariaChecked==`true`:ref.current.className?.includes(`rt-SliderRoot`)?ref.current.querySelector(`.rt-SliderThumb`)?.ariaValueNow:ref.current.value||ref.current.querySelector&&ref.current.querySelector(`:checked`)&&ref.current.querySelector(`:checked`)?.value},getRefValues=refs$1=>{if(refs$1)return refs$1.map(ref=>ref.current?ref.current.value||ref.current.getAttribute(`aria-valuenow`):null)},spreadArraysOrObjects=(first,second)=>{if(Array.isArray(first)&&Array.isArray(second))return[...first,...second];if(typeof first==`object`&&typeof second==`object`)return{...first,...second};throw Error(`Both parameters must be either arrays or objects.`)};var context_exports=__export({ClientSide:()=>ClientSide,ColorModeContext:()=>ColorModeContext,DispatchContext:()=>DispatchContext,EventLoopContext:()=>EventLoopContext,EventLoopProvider:()=>EventLoopProvider,StateContexts:()=>StateContexts,StateProvider:()=>StateProvider,UploadFilesContext:()=>UploadFilesContext,UploadFilesProvider:()=>UploadFilesProvider,clientStorage:()=>clientStorage,defaultColorMode:()=>defaultColorMode,exception_state_name:()=>void 0,initialEvents:()=>initialEvents,initialState:()=>initialState,isDevMode:()=>!1,onLoadInternalEvent:()=>onLoadInternalEvent,state_name:()=>void 0});const initialState={},defaultColorMode=`system`,ColorModeContext=(0,import_react.createContext)(null),UploadFilesContext=(0,import_react.createContext)(null),DispatchContext=(0,import_react.createContext)(null),StateContexts={},EventLoopContext=(0,import_react.createContext)(null),clientStorage={},state_name=void 0,exception_state_name=void 0,onLoadInternalEvent=()=>[],initialEvents=()=>[],isDevMode=!1;function UploadFilesProvider({children}){let[filesById,setFilesById]=(0,import_react.useState)({});return refs.__clear_selected_files=id=>setFilesById(filesById$1=>{let newFilesById={...filesById$1};return delete newFilesById[id],newFilesById}),(0,import_react.createElement)(UploadFilesContext.Provider,{value:[filesById,setFilesById]},children)}function ClientSide(component){return({children,...props})=>{let[Component,setComponent]=(0,import_react.useState)(null);return(0,import_react.useEffect)(()=>{setComponent(component)},[]),Component?jsx(Component,props,children):null}}function EventLoopProvider({children}){let[addEvents,connectErrors]=useEventLoop((0,import_react.useContext)(DispatchContext),initialEvents,clientStorage);return(0,import_react.createElement)(EventLoopContext.Provider,{value:[addEvents,connectErrors]},children)}function StateProvider({children}){return(0,import_react.createElement)(DispatchContext,{value:(0,import_react.useMemo)(()=>({}),[])},children)}export{context_exports as a,ReflexEvent as c,state_exports as d,StateProvider as i,isTrue as l,EventLoopContext as n,defaultColorMode as o,EventLoopProvider as r,isDevMode as s,ColorModeContext as t,refs as u};